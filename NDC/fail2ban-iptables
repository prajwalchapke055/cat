# ðŸ” **Practical: fail2ban + iptables**

## ðŸ—‚ï¸ **Setup**

| Role             | Hostname | IP Address     |
| ---------------- | -------- | -------------- |
| Protected Server | deb1     | 192.168.80.130 |
| Attacker         | deb2     | 192.168.80.128 |

---

## ðŸ“Œ **1ï¸âƒ£ Install fail2ban on Protected Server**

```bash
sudo apt-get update
sudo apt-get install -y python3-systemd fail2ban
```

âœ… Confirm:

```bash
ls -l /etc/fail2ban/jail.conf
```

---

## âš™ï¸ **2ï¸âƒ£ Create/Modify `jail.local`**

```bash
sudo nano /etc/fail2ban/jail.local
```

Add:

```ini
[sshd]
backend = systemd
enabled = true
port = 22
filter = sshd
maxretry = 3
bantime = 3600
findtime = 600
```

âœ… **Key Settings:**

- `enabled = true` â†’ Enable SSH jail
- `maxretry = 3` â†’ Max failed attempts
- `bantime = 3600` â†’ Ban for 1 hour
- `findtime = 600` â†’ Time window = 10 min

---

## ðŸ”„ **3ï¸âƒ£ Restart & Verify fail2ban**

```bash
sudo systemctl restart fail2ban
sudo systemctl status fail2ban
```

---

## ðŸ” **4ï¸âƒ£ Check fail2ban Status**

```bash
sudo fail2ban-client status
sudo fail2ban-client status sshd
```

âœ… Shows:

- Total failed attempts
- IPs banned
- Filter used

---

## ðŸ§± **5ï¸âƒ£ Verify iptables**

```bash
sudo iptables -L
```

## âœ… `fail2ban-sshd` chain appears â€” dynamically adds REJECT rules for banned IPs.

## ðŸ§ª **6ï¸âƒ£ Test from Attacker Machine (deb2)**

On **Debian-2**:

```bash
ssh shuhari@192.168.80.130
```

Try:

- Wrong password **3 times**
- The IP `192.168.80.128` will be **blocked for 1 hour**

---

## ðŸ”‘ **How it works**

- fail2ban watches `/var/log/auth.log` for `sshd` failed attempts.
- If attempts > `maxretry` in `findtime` â†’ Bans IP using `iptables`.

---

## âœ… **Expected Result**

| Check                       | Expected                                      |
| --------------------------- | --------------------------------------------- |
| fail2ban status             | Shows active jail: `sshd`                     |
| fail2ban-client status sshd | Shows banned IP                               |
| iptables -L                 | Contains `fail2ban-sshd` chain with banned IP |
| SSH retry from banned IP    | Connection refused                            |

---
