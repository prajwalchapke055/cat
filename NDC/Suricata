# ğŸ›¡ï¸ Suricata IDS

## ğŸ—‚ï¸ **Setup**

| Component       | Hostname | Interface |
| --------------- | -------- | --------- |
| Suricata Server | deb1     | ens33     |
| Attacker/Test   | deb2     | â€”         |

---

## ğŸ“Œ **1ï¸âƒ£ Install Suricata**

```bash
sudo apt-get update
sudo apt-get install suricata -y
```

âœ… Confirm installation:

```bash
sudo which suricata
```

---

## âš™ï¸ **2ï¸âƒ£ Configure Suricata**

```bash
sudo nano /etc/suricata/suricata.yml
```

**Edit these sections:**

ğŸ” **af-packet:**

```yaml
- interface: ens33
```

_(Your network interface)_

ğŸ” **rule-files:**

```yaml
rule-files:
  - suricata.rules
  - local.rules
```

âœ… This means Suricata will load:

- Default rules (`suricata.rules`)
- Your custom rules (`local.rules`)

---

## ğŸ“ **3ï¸âƒ£ Add Custom Ping Detection Rule**

```bash
sudo nano /etc/suricata/rules/local.rules
```

Add:

```bash
alert icmp any any -> any any (msg: "Ping Detected"; sid: 123; rev: 1;)
```

---

## ğŸ”„ **4ï¸âƒ£ Restart Suricata**

```bash
sudo systemctl restart suricata
sudo systemctl status suricata
```

âœ… **Status:**
Should show `active (running)`.

---

## ğŸ‘€ **5ï¸âƒ£ Tail Suricata Logs**

```bash
sudo tail -f /var/log/suricata/fast.log
```

---

## ğŸ§ª **6ï¸âƒ£ Test the Rule**

From **Debian 2**, ping the Suricata server:

```bash
ping <Suricata_Server_IP>
```

âœ… While pinging, your `fast.log` should show:

```
07/21/2025-15:01:45.123456 [**] [1:123:1] Ping Detected [**] [Classification: Generic ICMP event] [Priority: 3] {ICMP} <src_IP> -> <dst_IP>
```

---

# ğŸ›¡ï¸ Suricata IPS Mode

## ğŸ—‚ï¸ **Setup**

| Component        | Hostname | Role           |
| ---------------- | -------- | -------------- |
| Suricata Server  | deb1     | IPS            |
| Attacker Machine | deb2     | Generates ping |

---

## ğŸ“Œ **1ï¸âƒ£ Verify NFQUEUE Support**

```bash
suricata --build-info | grep NFQueue
```

âœ… Output must be:

```
NFQueue support : yes
```

---

## âš™ï¸ **2ï¸âƒ£ Edit Suricata Config for NFQUEUE**

```bash
sudo nano /etc/suricata/suricata.yml
```

âœ… Uncomment and set:

```yaml
nfq:
  mode: accept
  repeat-mark: 1
  repeat-mask: 1
  route-queue: 2
```

---

## ğŸ§© **3ï¸âƒ£ Install & Configure iptables**

```bash
sudo apt-get install iptables -y
```

âœ… Add iptables rules:

```bash
sudo iptables -I INPUT -p icmp -j NFQUEUE --queue-num 2
sudo iptables -I OUTPUT -p icmp -j NFQUEUE --queue-num 2
```

âœ… Verify:

```bash
sudo iptables -L -v
```

---

## ğŸ“ **4ï¸âƒ£ Add Drop Rule**

```bash
sudo nano /etc/suricata/rules/local.rules
```

Add:

```bash
drop icmp any any -> any any (msg: "Ping Detected"; sid: 123; rev:1;)
```

---

## ğŸ”„ **5ï¸âƒ£ Stop IDS Mode**

```bash
sudo systemctl stop suricata
sudo systemctl status suricata  # Should be inactive (dead)
```

---

## ğŸš¦ **6ï¸âƒ£ Start Suricata in IPS Mode**

```bash
sudo suricata -c /etc/suricata/suricata.yml -q 2
```

âœ… `-q 2` â†’ binds Suricata to NFQUEUE `2`.

---

## ğŸ§ª **7ï¸âƒ£ Test from Attacker**

On **Debian 2**:

```bash
ping <Suricata_Server_IP> -c 2
```

---

## âœ… **8ï¸âƒ£ Observe the Drop**

Back on the Suricata terminal, you should see:

```
[Drop] [1:123:1] Ping Detected {ICMP} ...
```

âœ… ICMP packets are _dropped_ â€” **Ping fails!**

---
