# ğŸ” Squid as a Reverse Proxy (Port 3128)

## **ğŸ–¥ï¸ Setup**

| Role               | OS               | Example IP       |
| ------------------ | ---------------- | ---------------- |
| Squid Proxy Server | Debian           | `192.168.80.130` |
| Backend Web Server | Debian (Apache2) | `192.168.80.129` |

---

## âœ… **Step 1: Install Squid on Proxy Server**

**ğŸ”¹ On Deb-01 (Proxy Server)**

```bash
# Install Squid
sudo apt-get install squid -y

# Verify installation path
sudo which squid

# Check total lines in config file
wc -l /etc/squid/squid.conf
```

---

## âœ… **Step 2: Edit `squid.conf`**

```bash
sudo nano /etc/squid/squid.conf
```

---

## âœ… **Step 3: Configure Sections**

**1ï¸âƒ£ **TAG: `acl`** â†’ Allow destination**

- ğŸ“ **Around Line `1330`**

```bash
acl my_site_acl dst 192.168.80.130
# Replace with Proxy Server IP
```

---

**2ï¸âƒ£ **TAG: `http_access`** â†’ Allow ACL**

- ğŸ“ **Around Line `1528`**

```bash
http_access allow my_site_acl
```

---

**3ï¸âƒ£ **TAG: `http_port`** â†’ Reverse Proxy Port**

- ğŸ“ **Around Line `2114`**

```bash
http_port 3128 accel vhost defaultsite=192.168.80.129
# 192.168.80.129 = Apache2 Backend IP
```

---

**4ï¸âƒ£ **TAG: `cache_peer`** â†’ Define Backend Server**

- ğŸ“ **Around Line `3483`**

```bash
cache_peer 192.168.80.129 parent 80 0 no_query originserver name=myServer
```

---

**5ï¸âƒ£ **TAG: `cache_peer_access`** â†’ Control Peer Access**

- ğŸ“ **Around Lines `3523`**

```bash
cache_peer_access myServer allow my_site_acl
cache_peer_access myServer deny all
```

---

## âœ… **Step 4: Restart Squid**

```bash
sudo systemctl restart squid

# Confirm status
sudo systemctl status squid
```

---

## âœ… **Step 5: Check Lines (Optional)**

```bash
sudo nano /etc/squid/squid.conf -l
```

---

## âœ… **Step 6: Test Reverse Proxy**

- Open a **browser** â†’ Access:

```
http://192.168.80.130:3128
```

âœ… You should see **Apache2â€™s page** from the backend (`192.168.80.129`).

---

# ğŸš¦ Practical: Load Balancing using Squid

| Machine    | Role                  | IP Address       |
| ---------- | --------------------- | ---------------- |
| **Deb-01** | Squid Load Balancer   | `192.168.80.130` |
| **Deb-02** | Backend Apache Server | `192.168.80.129` |
| **Deb-03** | Backend Apache Server | `192.168.80.133` |

---

## âœ… **Step 1: Verify Squid Installation**

```bash
sudo which squid
```

---

## âœ… **Step 2: Edit `squid.conf`**

```bash
sudo nano /etc/squid/squid.conf
```

---

## âœ… **Step 3: Configure Reverse Proxy with Load Balancing**

### ğŸ“Œ **a) Setup Listening Port**

- ğŸ” **Search:** `TAG: http_port`
- âœ… **Add or Edit:**

  ```bash
  http_port 80 vhost
  ```

---

### ğŸ“Œ **b) Setup Cache Peers**

- ğŸ” **Search:** `TAG: cache_peer`
- âœ… **Add both backend Apache servers:**

  ```bash
  cache_peer 192.168.80.129 parent 80 0 no-query originserver round-robin weight=1 name=myServer1
  cache_peer 192.168.80.133 parent 80 0 no-query originserver round-robin weight=1 name=myServer2
  ```

---

## âœ… **Step 4: Save & Restart Squid**

```bash
sudo systemctl restart squid
sudo systemctl status squid
```

---

## âœ… **Step 5: Remove Apache (if installed on Squid Server)**

```bash
sudo apt remove apache2
```

---

## âœ… **Step 6: Test Load Balancing**

1ï¸âƒ£ Open Browser:

```plaintext
http://192.168.80.130
```

2ï¸âƒ£ Refresh multiple times â€” you should see responses load-balanced from **Deb-02** and **Deb-03** Apache pages.

---
